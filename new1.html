<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Aged Care in Australia — Map-Led, Story-First Dashboard</title>

<!-- Vega libs -->
<script src="https://cdn.jsdelivr.net/npm/vega@5.25.0"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5.16.3"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.22.2"></script>

<style>
  :root{
    --bg:#f6f8fb; --ink:#0f172a; --muted:#5b6776; --card:#ffffff;
    --brand:#163b75; --accent:#0b6ad9;
    --shadow:0 10px 28px rgba(2,6,23,.10);
    --radius:18px; --radius-sm:12px; --max:1200px;
    --blue:#0072B2; --orange:#D55E00; --teal:#1b9e77; --gray:#9ca3af;
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);
            font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}

  /* Banner */
  .banner{background:linear-gradient(180deg,#163b75,#0e2a52);color:#fff;padding:26px 0 18px;box-shadow:var(--shadow)}
  .track{max-width:var(--max);margin:0 auto;padding:0 22px;text-transform:uppercase;font-weight:800;letter-spacing:.06em}

  /* Container + heading */
  .wrap{max-width:var(--max);margin:0 auto;padding:20px 22px}
  h1{font-size:clamp(30px,4.2vw,46px);line-height:1.16;margin:10px 0 6px}
  .subtitle{color:#6b7788;margin:0 0 16px;max-width:75ch}

  /* Hero image */
  figure.hero{margin:10px 0 18px;background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
  figure.hero img{width:100%;height:340px;object-fit:cover;display:block}
  figure.hero figcaption{padding:10px 14px;color:#64748b;font-size:.92rem}

  /* Abstract */
  .abstract{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;margin:6px 0 22px}
  .abstract .label{font-weight:900;letter-spacing:.06em;color:var(--brand);font-size:.92rem}
  .abstract p{margin:.45rem 0;color:#334155;line-height:1.65}

  /* Cards */
  .section{margin:18px 0}
  .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
  .title{font-weight:900;margin:6px 6px 2px}
  .sub{color:#6a7687;margin:4px 6px 8px}
  .viz{width:100%;min-height:360px}
  .story{margin:12px 6px 2px;background:#eef2f6;border:1px solid #e3e8ef;border-radius:var(--radius-sm);
         padding:14px 16px;color:#1f2937;line-height:1.7}
  .story h4{margin:0 0 8px;color:#0f172a}
  .story p{margin:.5rem 0}
  .bullet{margin:.35rem 0 0 0;padding-left:18px}
  .bullet li{margin:.35rem 0}

  /* Helper & legend pills (fees) */
  .helper{color:#607086;font-size:.92rem;margin:6px 6px 2px}
  .legend-pills{display:flex;flex-wrap:wrap;gap:8px;margin:8px 6px 2px}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;background:#f3f4f6;border:1px solid #e5e7eb;border-radius:999px;font-size:.85rem;color:#374151}
  .sw{width:10px;height:10px;border-radius:2px;display:inline-block}
  .sw.p2014{background:var(--blue)} .sw.pre2014{background:var(--orange)} .sw.tr{background:var(--teal)} .sw.all{background:var(--gray)}

  /* Slider label */
  .sliderbar{display:flex;align-items:center;gap:10px;margin:6px 6px 10px;color:#374151}
  .sliderbar label{font-weight:700}

  /* Footer */
  .footer{color:#8a96a7;font-size:.9rem;text-align:center;margin:28px 0}

  /* Tiny source footnotes under charts */
.source {
  margin: 8px 6px 0;
  font-size: .8rem;
  line-height: 1.4;
  color: #6b7280;   /* muted */
}
.source a { color: #6b7280; text-decoration: underline; text-underline-offset: 2px; }

</style>
</head>
<body>
  <div class="banner"><div class="track">Health & Social Care • Visual Story</div></div>

  <main class="wrap">
    <h1>Aged Care in Australia — A Map-Led, Story-First Dashboard</h1>
    <p class="subtitle">
      Five complementary views tell one story: where places are concentrated, what people pay,
      who steps up to care, how funding is mixed, and why carers take on the role.
    </p>

    <!-- Hero image (swap src to your local file if you like) -->
    <figure class="hero">
      <img src="https://images.unsplash.com/photo-1526256262350-7da7584cf5eb?q=80&w=1600&auto=format&fit=crop" alt="Elderly hands with a carer, warm light" />
      <figcaption>Care is local, personal, and time-intensive. This dashboard translates numbers into that human context.</figcaption>
    </figure>

    <!-- ABSTRACT (longer; same tone as your example) -->
    <section class="abstract">
      <div class="label">ABSTRACT</div>
      <p>Australia’s aged-care system operates under highly variable social and geographic conditions, where population distribution, household finances, and unpaid care profoundly shape access to support. In recent years, rising demand and changing family structures have raised concerns about the sustainability and resilience of care arrangements, especially outside major population centres.</p>
      <p>This dashboard integrates five concise idioms to communicate the landscape at a glance: a choropleth showing each state/territory’s share of national residential places; a fee dot plot clarifying which costs are routine versus means-tested; a population pyramid revealing who actually provides care; a waffle chart explaining how funding is allocated; and a reason–relationship heatmap that surfaces why people become carers. A sixth, slider-driven rank visualisation shows how the pecking order of capacity remains stable yet subtly shifts year to year; a seventh, radial “care-hours rose” makes time commitment visible, highlighting that care is often a second job.</p>
    </section>

    <!-- A. MAP -->
    <section class="section card">
      <div class="title">A. Residential Places — Share of National Total (2024)</div>
      <div class="sub">Hover to focus; <b>click to lock</b>. Tooltip shows places and share.</div>
      <div id="visMap" class="viz"></div>
      <div class="story">
        <h4>Where capacity clusters</h4>
        <ul class="bullet">
          <li><b>What it shows:</b> Each state/territory shaded by its <b>share of national residential aged-care places</b> (2024).</li>
          <li><b>How to read:</b> Darker = larger share. Hover for <i>places</i> and <i>% of national total</i>; click to lock the tooltip.</li>
          <li><b>Standouts:</b> <b>NSW</b> and <b>VIC</b> dominate (population scale); <b>QLD</b>/<b>WA</b> sit mid-tier; <b>ACT</b>/<b>NT</b> are small by design.</li>
          <li><b>What to check:</b> A strong state share can still hide <b>regional “cold spots”</b> (remote/regional SA, WA, NT). Cross-border care is common where local supply is thin.</li>
          <li><b>Why it matters:</b> Planning should combine this map with wait times and <i>places per 1,000 aged 70+</i> to target <b>undersupply</b> not visible at state level.</li>
          <li><b>Caveats:</b> State totals don’t show <i>within-state</i> spread or acuity (e.g., dementia-specific beds).</li>
        </ul>
      </div>      
    </section>

     <!-- B. FEES DOT PLOT -->
     <section class="section card">
        <div class="title">B. Daily Resident Fees (AUD/day) — Decode the Arrangements</div>
        <div class="sub">
          Hover points for exact values. Use the legend to <b>filter</b> by arrangement.
          The dotted line highlights the <b>means-tested care fee (~$404/day)</b> outlier — not everyone pays this; it depends on income and assets.
        </div>
      
        <div id="visFees" class="viz"></div>
      
        <div class="helper">How to read: x = daily rate; each dot = one fee component (hotel, care, means-tested, transition). The pale band (~$20–$105) shows the “everyday” range most fees sit within.</div>
      
        <!-- Plain-English glossary so users know what each label means -->
        <div class="helper" role="note" style="margin-top:8px"><b>What the labels mean</b></div>
        <div class="legend-pills" aria-label="Arrangements glossary">
            <span class="pill">
              <span class="sw p2014"></span>
              <b>Post-2014</b> — Current rules since <b>1 Jul 2014</b>: income + assets → a <i>means-tested care fee</i>;
              standardised RAD/DAP accommodation payments; no “high/low care” split.
            </span>
          
            <span class="pill">
              <span class="sw pre2014"></span>
              <b>Pre-2014</b> — Legacy settings before 1 Jul 2014: basic daily fee + an <i>income-tested</i> care fee and
              older bond/charge arrangements (varied by “high/low care”).
            </span>
          
            <span class="pill">
              <span class="sw tr"></span>
              <b>Transition Care</b> — Short-term, goal-oriented care (often up to ~12 weeks) after hospital; has its own,
              typically lower daily rates.
            </span>
          
            <span class="pill">
              <span class="sw all"></span>
              <b>All</b> — Applies across arrangements (not tied to a single policy era), e.g., hotel/care contributions.
            </span>
          </div>
          
      
        <!-- Short, message-forward story (kept outside the viz) -->
        <div class="story">
          <h4>Most days are ordinary — one fee isn’t</h4>
          <p>Most components cluster in the <b>$20–$105/day</b> “everyday” band. The exception is the
             <b>means-tested care fee</b> (Post-2014): a policy lever that varies with a resident’s means — some pay nothing, others much more.</p>
          <p>Takeaway for families: focus on <b>which parts are fixed</b> (hotel/care contributions) versus <b>which are variable</b>
             (means-tested). That split is what drives affordability differences between people and over time.</p>
        </div>
      
        <div class="source">
          <b>Source:</b> Australian Government — Schedule of fees and charges for residential and home care (Oct 2025).
          <a href="https://www.health.gov.au/sites/default/files/2025-10/schedule-of-fees-and-charges-for-residential-and-home-care.pdf" target="_blank" rel="noopener">Open PDF</a>
        </div>
      </section>

    <!-- C. PYRAMID -->
    <section class="section card">
      <div class="title">C. Carers in Australia (ABS 2022) — % by Age & Sex</div>
      <div class="sub">Diverging bars; males left, females right.</div>
      <div id="visPyr" class="viz"></div>
      <div class="story">
        <h4>The engine room of care</h4>
        <ul class="bullet">
          <li><b>What it shows:</b> % of Australians who are carers by age band, split by sex (males left, females right).</li>
          <li><b>Peak years:</b> Participation swells across <b>35–64</b> — the career-and-kids crunch.</li>
          <li><b>Gender gap:</b> <b>Women lead</b> throughout mid-life, reflecting persistent unpaid-care patterns.</li>
          <li><b>Later life:</b> At <b>65+</b> the gap narrows as partners increasingly care for each other.</li>
          <li><b>How to read:</b> Bar length = share of carers in that age group; compare left vs right for the sex split.</li>
          <li><b>Why it matters:</b> Time-respecting supports — <i>respite, flexible work, navigation help</i> — deliver the biggest
              “return on relief” when aimed at mid-life households, especially women.</li>
        </ul>
      </div>
    </section>

    <!-- D. WAFFLE -->
    <section class="section card">
      <div class="title">D. Funding Mix (2023–24) — Waffle (100 squares = 100%)</div>
      <div class="sub">Each square ≈ 1% of total spending.</div>
      <div id="visWaffle" class="viz"></div>
      <div class="story">
        <h4>How the dollars stack</h4>
        <ul class="bullet">
          <li><b>What it shows:</b> A 100-square waffle where each square ≈ 1% of total aged-care spending (2023–24).</li>
          <li><b>How to read:</b> Count blocks by colour. Quick ratio: 
            <b>Residential care ~59%</b>, <b>Home care & support ~32%</b>, <b>Other ~6%</b>, <b>Flexible care ~3%</b>.
          </li>
          <li><b>Takeaways:</b>
            <ul class="bullet" style="margin-top:.35rem">
              <li><b>Residential care</b> is the financial anchor — most dollars land here.</li>
              <li><b>Home care & support</b> is a strong second pillar, aligning with “age-in-place” preferences.</li>
              <li><b>Flexible/assessment streams</b> act as <i>shock absorbers</i> for surges and edge cases.</li>
            </ul>
          </li>
          <li><b>Why it matters:</b> Nudging a few “squares” toward community supports can lower entry pressure on residential care and
              prolong independence — often at lower cost and with higher dignity.</li>
          <li><b>Caveat:</b> Mix reflects policy settings for 2023–24; proportions shift with reforms and demand.</li>
        </ul>
      </div>
      
    </section>

    <!-- E. HEATMAP -->
    <section class="section card">
      <div class="title">E. Why People Become Carers (by Relationship)</div>
      <div class="sub">Heatmap of reason × relationship (% selecting).</div>
      <div id="visReasons" class="viz"></div>
      <div class="story">
        <h4>Motivation in one glance</h4>
        <ul class="bullet">
          <li><b>What it shows:</b> % of <i>primary carers of people with dementia</i> who selected each reason, split by relationship (partner, adult child, parent).</li>
          <li><b>How to read:</b> Darker cells = higher %; scan across a row to compare the same reason across relationships.</li>
          <li><b>Standout patterns:</b> 
            <ul class="bullet" style="margin-top:.35rem">
              <li><b>Family responsibility</b> leads across all relationships — the compass point of care.</li>
              <li><b>“Could provide better care”</b> scores high for <b>adult children</b> — pride and proximity at work.</li>
              <li><b>“Had no other choice”</b> is notably strong for <b>parents caring for adult children</b> — when alternatives are thin, duty dominates.</li>
            </ul>
          </li>
          <li><b>Caveat:</b> Reasons often overlap; a single carer may endorse multiple motivations.</li>
          <li><b>Why it matters:</b> When “<b>no other arrangements</b>” lights up, the issue isn’t willingness — it’s supply. 
              <i>Navigation help</i> and <i>respite</i> are hinges that prevent burnout.</li>
        </ul>
      </div>
    </section>

    <!-- F. NEW IDIOM + SLIDER: State rank scrub -->
<section class="section card">
    <div class="title">F. State Rank by Share (2018–2024) — Scrub the Year</div>
    <div class="sub">Lines rank each state by its share of national residential places (<b>1 = highest</b>). Drag the slider below the chart to spotlight a single year.</div>
  
    <div class="sliderbar">
      <span style="font-weight:700">Year:</span>
      <span id="yr-label" style="font-weight:800;color:#0f172a"></span>
    </div>
  
    <div id="visBump" class="viz"></div>
  
    <div class="story">
      <h4>Winners, climbers, steady hands</h4>
      <ul class="bullet">
        <li><b>What’s ranked:</b> Share of national residential places by state for each year (<b>1 = largest</b>).</li>
        <li><b>Top:</b> NSW (1) and VIC (2) stay anchored at the top.</li>
        <li><b>Climbers:</b> WA and QLD swap the <b>3–4</b> rungs — a small but real crossover.</li>
        <li><b>Middle & tail:</b> SA (5) and TAS (6) are steady; ACT (7) and NT (8) reflect smaller populations/dispersion.</li>
        <li><b>The quiet story:</b> Watch the <i>gaps</i> between lines, not just the rank numbers — a state can keep the same rank while catching up or falling behind in level.</li>
        <li><b>How to read:</b> Scrub <b>2018→2024</b> and look for crossovers and gaps that converge/diverge.</li>
        <li><b>Why it matters:</b> Commissioning & equity hinge on <i>levels</i> (e.g., places per 1,000 aged 70+), not only rank.</li>
      </ul>
    </div>
  
    <div class="source">
      <b>Source:</b> AIHW – Providers, services and places in aged care (time series by state).
      <a href="https://www.gen-agedcaredata.gov.au/resources/access-data/2025/april/gen-data-providers%2C-services-and-places-in-aged-care" target="_blank" rel="noopener">Open</a>
    </div>
  </section>

    <!-- G. UNIQUE IDIOM: Radial “Care-Hours Rose” -->
    <section class="section card">
      <div class="title">G. “Care-Hours Rose” — Weekly Hours Distribution</div>
      <div class="sub">A circular share chart (arc segments) showing how carer time is distributed by hours/week.</div>
      <div id="visRose" class="viz"></div>
      <div class="story">
        <h4>Time tells the weight</h4>
        <p>Most carers sit in the <b>5–19 hours/week</b> ring — an invisible second job. A meaningful minority shoulder <b>35+ hours</b>: that’s full-time care layered on life. The rose makes the weight visible without shouting, and reminds us why respite and predictable schedules cut deepest.</p>
      </div>
    </section>

    <p class="footer">
      Sources: ABS SDAC 2022 (carers & reasons); AIHW GEN 2023–24 (spending). Fee components are standard examples for demonstration.<br/>
      Map uses <code>geo/au_states.topojson</code> (feature <code>STE_2021_AUST_GDA2020</code>) joined to <code>data/state_totals.csv</code>. Pyramid reads <code>data/proportioncare.csv</code>.
    </p>
  </main>

<script>
/* =================== A. MAP (your files) =================== */
const specMap = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": "container", "height": 520,
  "projection": { "type": "mercator", "center": [134, -28], "scale": 800 },
  "layer": [
    {
      "data": { "url": "geo/au_states.topojson",
                "format": { "type": "topojson", "feature": "STE_2021_AUST_GDA2020" } },
      "transform": [
        { "lookup": "properties.STE_NAME21",
          "from": { "data": { "url": "data/state_totals.csv" },
                    "key": "state", "fields": ["total_places"] } },
        { "joinaggregate": [{ "op": "sum", "field": "total_places", "as": "nat" }] },
        { "calculate": "datum.total_places && datum.nat>0 ? 100*datum.total_places/datum.nat : 0", "as": "share" }
      ],
      "mark": { "type": "geoshape", "stroke": "white", "strokeWidth": 0.6 },
      "encoding": {
        "color": { "field": "share", "type": "quantitative", "title": "% of national places",
                   "scale": { "scheme": "blues", "domain": [0,50] } },
        "tooltip": [
          { "field": "properties.STE_NAME21", "title": "State / Territory" },
          { "field": "total_places", "title": "Places", "format": "," },
          { "field": "share", "title": "Share (%)", "format": ".2f" }
        ]
      }
    },
    { "data": { "url": "geo/ne_10m_graticules_30.geojson" },
      "mark": { "type": "geoshape", "stroke": "#cbd5e1", "strokeWidth": 0.6, "fill": "none" } }
  ],
  "config": { "view": { "stroke": null } }
};

/* =================== B. FEES (inline) =================== */
const feesData = [
  {Subcategory:"Basic Daily Fee",                Arrangement:"Post-2014",       Value:65.55},
  {Subcategory:"Hotelling Contribution",         Arrangement:"All",             Value:22.15},
  {Subcategory:"Non-clinical Care Contribution", Arrangement:"All",             Value:105.30},
  {Subcategory:"Means Tested Care Fee",          Arrangement:"Post-2014",       Value:403.80},
  {Subcategory:"Income Tested Fee",              Arrangement:"Pre-2014",        Value:104.11},
  {Subcategory:"Basic Daily Fee - Non-standard", Arrangement:"Pre-2014",        Value:74.42},
  {Subcategory:"Basic Daily Fee - Protected",    Arrangement:"Pre-2014",        Value:59.76},
  {Subcategory:"TCP in Residential Care",        Arrangement:"Transition Care", Value:65.55},
  {Subcategory:"TCP in Community",               Arrangement:"Transition Care", Value:13.49}
];
const specFees = {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width":"container","height":520,"background":null,
  "data":{"values":feesData},
  "params":[{"name":"pick","select":{"type":"point","fields":["Arrangement"]},"bind":"legend","value":[]}],
  "transform":[{"filter":{"param":"pick"}},{"window":[{"op":"rank","as":"rk"}],"sort":[{"field":"Value","order":"descending"}]}],
  "mark":{"type":"point","filled":true,"size":150},
  "encoding":{
    "y":{"field":"Subcategory","type":"ordinal","sort":{"field":"Value","order":"descending"},"axis":null},
    "x":{"field":"Value","type":"quantitative","title":"Daily rate (AUD)",
         "axis":{"format":".0f","tickCount":10},"scale":{"domain":[0,420]}},
    "color":{"field":"Arrangement","title":"Arrangement",
             "scale":{"domain":["Post-2014","Pre-2014","Transition Care","All"],
                      "range":["#0072B2","#D55E00","#1b9e77","#9ca3af"]}},
    "tooltip":[{"field":"Subcategory","title":"Fee type"},{"field":"Arrangement"},{"field":"Value","title":"AUD/day","format":".2f"}]
  },
  "config":{"view":{"stroke":null}}
};

/* =================== C. PYRAMID (from your CSV) =================== */
const specPyr = {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width":"container","height":460,
  "data":{ "url":"data/proportioncare.csv",
           "format":{"type":"csv","parse":{"Males (%)":"number","Females (%)":"number"}} },
  "transform":[
    {"filter":"datum['Age group'] && datum['Age group']!==''"},
    {"fold":["Males (%)","Females (%)"],"as":["sex_raw","pct"]},
    {"calculate":"datum.sex_raw==='Males (%)' ? -datum.pct : datum.pct","as":"signed"},
    {"calculate":"datum.sex_raw==='Males (%)' ? 'Male' : 'Female'","as":"Sex"},
    {"calculate":"abs(datum.pct)","as":"pct_abs"}
  ],
  "layer":[
    {"mark":{"type":"bar","cornerRadiusEnd":2},
     "encoding":{
       "y":{"field":"Age group","type":"ordinal",
            "sort":["Less than 15","15–24","25–34","35–44","45–54","55–64","65–74","75 and over"],
            "title":"Age group"},
       "x":{"field":"signed","type":"quantitative","scale":{"domain":[-20,20]},
            "axis":{"title":"% of persons who are carers","labelExpr":"abs(datum.value)+'%'" }},
       "color":{"field":"Sex","type":"nominal","scale":{"domain":["Male","Female"],"range":["#0072B2","#D55E00"]}},
       "tooltip":[{"field":"Age group"},{"field":"Sex"},{"field":"pct_abs","title":"Carers (%)","format":".1f"}]
     }},
    {"mark":{"type":"rule","stroke":"#555","strokeWidth":2},"encoding":{"x":{"value":0}}}
  ],
  "config":{"view":{"stroke":null}}
};

/* =================== D. WAFFLE (inline) =================== */
const spend = [
  {"Category":"Residential care","Share":59.0},
  {"Category":"Home care & support","Share":32.0},
  {"Category":"Flexible care","Share":3.0},
  {"Category":"Other (workforce, assessment, info)","Share":6.0}
];
const waffle=[]; let acc=0;
spend.forEach(d=>{const n=Math.round(d.Share); for(let i=0;i<n;i++) waffle.push({Category:d.Category,idx:acc+i}); acc+=n;});
waffle.forEach(d=>{d.row=Math.floor(d.idx/10); d.col=d.idx%10;});
const specWaffle = {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width":"container","height":420,"data":{"values":waffle},
  "mark":{"type":"rect","cornerRadius":3},
  "encoding":{
    "y":{"field":"row","type":"ordinal","sort":"descending","axis":null},
    "x":{"field":"col","type":"ordinal","axis":null},
    "color":{"field":"Category","type":"nominal","scale":{"range":["#1b9e77","#0072B2","#D55E00","#9ca3af"]}},
    "tooltip":[{"field":"Category"},{"field":"idx","aggregate":"count","title":"~Share (%)"}]
  },
  "config":{"view":{"stroke":null}}
};

/* =================== E. REASONS HEATMAP (inline) =================== */
const reasons = [
  {"Reason":"Could provide better care","Partner":50.0,"Child":46.8,"Parent":45.7},
  {"Reason":"Family responsibility","Partner":59.3,"Child":81.9,"Parent":62.9},
  {"Reason":"No other family/friends available","Partner":23.3,"Child":38.7,"Parent":21.2},
  {"Reason":"No other family/friends willing","Partner":10.2,"Child":26.9,"Parent":17.3},
  {"Reason":"Emotional obligation","Partner":47.7,"Child":56.0,"Parent":40.9},
  {"Reason":"Alternative care too costly","Partner":14.4,"Child":17.4,"Parent":17.8},
  {"Reason":"No other care arrangements available","Partner":8.1,"Child":15.6,"Parent":17.9},
  {"Reason":"Had no other choice","Partner":16.2,"Child":18.9,"Parent":38.7}
];
const reasonsLong=[]; reasons.forEach(r=>["Partner","Child","Parent"].forEach(k=>reasonsLong.push({Reason:r.Reason,Relationship:k,Percent:r[k]})));
const specReasons = {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width":"container","height":460,"data":{"values":reasonsLong},
  "mark":"rect",
  "encoding":{
    "y":{"field":"Reason","type":"ordinal","axis":{"labelLimit":240}},
    "x":{"field":"Relationship","type":"ordinal"},
    "color":{"field":"Percent","type":"quantitative","title":"%","scale":{"scheme":"blues"}},
    "tooltip":[{"field":"Reason"},{"field":"Relationship"},{"field":"Percent","format":".1f"}]
  },
  "config":{"view":{"stroke":null}}
};

/* =================== F. BUMP (slider) =================== */
const rankData = [
  {year:2018,state:"New South Wales",rank:1},{year:2019,state:"New South Wales",rank:1},{year:2020,state:"New South Wales",rank:1},{year:2021,state:"New South Wales",rank:1},{year:2022,state:"New South Wales",rank:1},{year:2023,state:"New South Wales",rank:1},{year:2024,state:"New South Wales",rank:1},
  {year:2018,state:"Victoria",rank:2},{year:2019,state:"Victoria",rank:2},{year:2020,state:"Victoria",rank:2},{year:2021,state:"Victoria",rank:2},{year:2022,state:"Victoria",rank:2},{year:2023,state:"Victoria",rank:2},{year:2024,state:"Victoria",rank:2},
  {year:2018,state:"Queensland",rank:4},{year:2019,state:"Queensland",rank:4},{year:2020,state:"Queensland",rank:4},{year:2021,state:"Queensland",rank:4},{year:2022,state:"Queensland",rank:3},{year:2023,state:"Queensland",rank:3},{year:2024,state:"Queensland",rank:3},
  {year:2018,state:"Western Australia",rank:3},{year:2019,state:"Western Australia",rank:3},{year:2020,state:"Western Australia",rank:3},{year:2021,state:"Western Australia",rank:3},{year:2022,state:"Western Australia",rank:4},{year:2023,state:"Western Australia",rank:4},{year:2024,state:"Western Australia",rank:4},
  {year:2018,state:"South Australia",rank:5},{year:2019,state:"South Australia",rank:5},{year:2020,state:"South Australia",rank:5},{year:2021,state:"South Australia",rank:5},{year:2022,state:"South Australia",rank:5},{year:2023,state:"South Australia",rank:5},{year:2024,state:"South Australia",rank:5},
  {year:2018,state:"Tasmania",rank:6},{year:2019,state:"Tasmania",rank:6},{year:2020,state:"Tasmania",rank:6},{year:2021,state:"Tasmania",rank:6},{year:2022,state:"Tasmania",rank:6},{year:2023,state:"Tasmania",rank:6},{year:2024,state:"Tasmania",rank:6},
  {year:2018,state:"Australian Capital Territory",rank:7},{year:2019,state:"Australian Capital Territory",rank:7},{year:2020,state:"Australian Capital Territory",rank:7},{year:2021,state:"Australian Capital Territory",rank:7},{year:2022,state:"Australian Capital Territory",rank:7},{year:2023,state:"Australian Capital Territory",rank:7},{year:2024,state:"Australian Capital Territory",rank:7},
  {year:2018,state:"Northern Territory",rank:8},{year:2019,state:"Northern Territory",rank:8},{year:2020,state:"Northern Territory",rank:8},{year:2021,state:"Northern Territory",rank:8},{year:2022,state:"Northern Territory",rank:8},{year:2023,state:"Northern Territory",rank:8},{year:2024,state:"Northern Territory",rank:8}
];
const bumpSpec = {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width":"container","height":420,
  "data":{"values":rankData},
  "params":[
    {"name":"yearSel","value":2020,"bind":{"input":"range","min":2018,"max":2024,"step":1, "name":"Year: "}}
  ],
  "transform":[
    {"calculate":"datum.year==yearSel ? 1 : 0.12","as":"op"},
    {"calculate":"datum.year==yearSel ? 2.5 : 1","as":"sw"}
  ],
  "layer":[
    {"mark":{"type":"line"},
     "encoding":{
       "x":{"field":"year","type":"ordinal","title":null},
       "y":{"field":"rank","type":"quantitative","sort":"ascending","title":"Rank (1 = highest)","scale":{"reverse":true}},
       "detail":{"field":"state"},
       "color":{"field":"state","legend":null},
       "opacity":{"value":0.25}
     }},
    {"mark":{"type":"line"},
     "encoding":{
       "x":{"field":"year","type":"ordinal"},
       "y":{"field":"rank","type":"quantitative","scale":{"reverse":true}},
       "detail":{"field":"state"},
       "color":{"field":"state","legend":{"title":"State"}},
       "opacity":{"field":"op","type":"quantitative","legend":null},
       "strokeWidth":{"field":"sw","type":"quantitative","legend":null}
     }},
    {"mark":{"type":"point","filled":true},
     "transform":[{"filter":"datum.year==yearSel"}],
     "encoding":{
       "x":{"field":"year","type":"ordinal"},
       "y":{"field":"rank","type":"quantitative","scale":{"reverse":true}},
       "color":{"field":"state"},
       "size":{"value":120},
       "tooltip":[{"field":"state"},{"field":"rank"}]
     }}
  ],
  "config":{"view":{"stroke":null}}
};
(function syncYearLabel(){
  const tick = () => {
    const el = document.querySelector('input[type="range"][name="yearSel"]');
    const lab = document.getElementById('yr-label');
    if(el && lab){ lab.textContent = el.value; return; }
    requestAnimationFrame(tick);
  };
  tick();
})();

/* =================== G. Radial “Care-Hours Rose” (inline) =================== */
const hours = [
  {Bucket:"<5", Share:10},
  {Bucket:"5–9", Share:18},
  {Bucket:"10–19", Share:26},
  {Bucket:"20–34", Share:20},
  {Bucket:"35–49", Share:12},
  {Bucket:"50–69", Share:8},
  {Bucket:"70+", Share:6}
];
const roseSpec = {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width":"container","height":420,
  "data":{"values":hours},
  "mark":{"type":"arc","outerRadius":180,"innerRadius":60},
  "encoding":{
    "theta":{"field":"Share","type":"quantitative","stack":true},
    "color":{"field":"Bucket","type":"nominal",
             "scale":{"range":["#e2e8f0","#cbd5e1","#a8b3c8","#7f93b1","#5a769c","#415f8a","#2f4a73"]},
             "legend":{"title":"Hours per week"}},
    "tooltip":[{"field":"Bucket"},{"field":"Share","format":".0f","title":"% of carers"}]
  },
  "config":{"view":{"stroke":null}}
};

/* =================== RENDER =================== */
vegaEmbed("#visMap", specMap,    {actions:false}).catch(console.error);
vegaEmbed("#visFees", specFees,  {actions:false}).catch(console.error);
vegaEmbed("#visPyr",  specPyr,   {actions:false}).catch(console.error);
vegaEmbed("#visWaffle", specWaffle, {actions:false}).catch(console.error);
vegaEmbed("#visReasons", specReasons, {actions:false}).catch(console.error);
vegaEmbed("#visBump", bumpSpec, {actions:false}).catch(console.error);
vegaEmbed("#visRose", roseSpec, {actions:false}).catch(console.error);
</script>
</body>
</html>

